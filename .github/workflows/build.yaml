name: Build
on:
  push:
    branches:
      - "*"
    paths-ignore:
      - README.md
      - .github/dependabot.yaml
      - .github/workflow/build.yaml
    tags:
      - "v*.*.*"

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest

    steps:
      - name: Git checkout
        uses: actions/checkout@v2
        with:
          submodules: true

      - name: Helm toolset install
        uses: hiberbee/github-action-helm@1.5.0

      - name: Prepare
        run: |
          curl -s -L -o /usr/local/bin/gomplate https://github.com/hairyhenderson/gomplate/releases/download/v3.10.0/gomplate_linux-amd64 &&
          chmod +x /usr/local/bin/gomplate

      - name: Build
        run: |
          make all

      - name: Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: output/kube-renderer.sh

